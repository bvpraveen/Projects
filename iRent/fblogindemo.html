<html>
<head>
<script type="text/javascript">
  function login() {
  
  alert('Inside login');
  
    FB.login(function(response) {
        if (response.authResponse) {
            // connected
            alert('Connected now!');
            testAPI();
        } else {
            // cancelled
            alert('User cancelled');
        }
    });
}
function logout()
{
	alert('Logged out!');
}
function testAPI() {

    alert('Welcome!  Fetching your information.... ');
    FB.api('/me', function(response) {
        alert('Good to see you, ' + response.name + '.'+response.username);
    });
    FB.api('/me', function(userInfo) {
        alert(userInfo.name + ': ' + userInfo.email);
      });
}
</script>
</head>
<body>
<div id="fb-root"></div>
<script>
  window.fbAsyncInit = function() {
    // init the FB JS SDK
    FB.init({
      appId      : '316843605051461',                        // App ID from the app dashboard
      status     : true,                                 // Check Facebook Login status
      xfbml      : true                                  // Look for social plugins on the page
    });
				

   FB.getLoginStatus(
   function(response) 
   {
//	alert('Reponse');
	
  
 });
    // Additional initialization code such as adding Event Listeners goes here

     //FB.Event.subscribe('auth.login', function(response) { this.page.reload();  alert('Logged in'); alert(response.authResponse.userID); });
     //FB.Event.subscribe('auth.authResponseChange' , function(response) { alert('Response chage'); alert(response.authResponse.userID) });
     FB.Event.subscribe('auth.statusChange', function(response) 
     {  
     		alert(response.status);
     		if(response.status == 'connected')
     		{
     		     testAPI(); 
     		}
     });
     //FB.Event.subscribe('auth.logout', function(response) { logout(); });
     



      };
 </script>
 <script>
  // Load the SDK asynchronously
  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/all.js";
     fjs.parentNode.insertBefore(js, fjs);

   }(document, 'script', 'facebook-jssdk'));   
</script>
<?php

       $app_id = "316843605051461";
       $app_secret = "cca38af5eac19fb63938d0c146fcc77f";
       $post_login_url = "http://localhost:8080/irent/fblogindemo.html";
       $album_name = 'irentalbum';
       $album_description = 'Houseforrent';
       $code = $_REQUEST["code"];

       //Obtain the access_token with publish_stream permission 
       if(empty($code))
         {
	   echo 'Praveen';
           $dialog_url= "http://www.facebook.com/dialog/oauth?"
           . "client_id=" . $app_id 
           . "&redirect_uri=" . urlencode($post_login_url)
           . "&scope=publish_stream";
           echo("<script>top.location.href='".$dialog_url."'</script>");
       } 
       else {
         $token_url= "https://graph.facebook.com/oauth/"
         . "access_token?"
         . "client_id=" .  $app_id 
         . "&redirect_uri=" . urlencode( $post_login_url)
         . "&client_secret=" . $app_secret
         . "&code=" . $code;
         $response = file_get_contents($token_url);
         $params = null;
         parse_str($response, $params);
         $access_token = $params['access_token'];

         // Create a new album
         $graph_url = "https://graph.facebook.com/me/albums?"
         . "access_token=". $access_token;
   
         $postdata = http_build_query(
         array(
          'name' => $album_name,
          'message' => $album_description
            )
          );
         $opts = array('http' =>
         array(
          'method'=> 'POST',
          'header'=>
            'Content-type: application/x-www-form-urlencoded',
          'content' => $postdata
          )
         );
         $context  = stream_context_create($opts);
         $result = json_decode(file_get_contents($graph_url, false, 
           $context));

         // Get the new album ID
         $album_id = $result->id;

         //Show photo upload form and post to the Graph URL
         $graph_url = "https://graph.facebook.com/". $album_id
           . "/photos?access_token=" . $access_token;
         echo '<html><body>';
         echo '<form enctype="multipart/form-data" action="'
         .$graph_url. ' "method="POST">';
         echo 'Adding photo to album: ' . $album_name .'<br/><br/>';
         echo 'Please choose a photo: ';
         echo '<input name="source" type="file"><br/><br/>';
         echo 'Say something about this photo: ';
         echo '<input name="message" type="text"
            value=""><br/><br/>';
         echo '<input type="submit" value="Upload" /><br/>';
         echo '</form>';
         echo '</body></html>';
      }
 ?>


<fb:login-button autologoutlink='true' data-show-faces='true' perms='email,user_birthday,status_update,publish_stream' width='200' data-max-rows='1'></fb:login-button>

</body>
</html>